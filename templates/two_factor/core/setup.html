{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load widget_tweaks %}

{% block content %}
<div class="twofa_container" >
    <div align="center" >
  <h1>{% block title %}{% trans "Enable Two-Factor Authentication" %}{% endblock %}</h1>
    </div>


  {% if wizard.steps.current == 'welcome' %}
      <div align="center">
      <br>
    <p class ="para">{% blocktrans trimmed %}You are about to take your account security to the
        next level.
        {% endblocktrans %}</p>

        <p class ="para">{% blocktrans trimmed %}In order to use the website you must ensure you follow the steps in this wizard to enable two-factor
        authentication.{% endblocktrans %}</p><br>
      </div>

  {% elif wizard.steps.current == 'method' %}

      <p>{% blocktrans trimmed %}Please select which authentication method you would
        like to use.{% endblocktrans %}</p>

  {% elif wizard.steps.current == 'generator' %}
<div align="center">
<br>
    <p class ="para">{% blocktrans trimmed %}To start using a token generator, please use your
        smartphone to scan the QR code below.{% endblocktrans %}</p>

        <p class ="para">{% blocktrans trimmed %}For example, use Google
        Authenticator. Then, enter the token generated by the app.
        {% endblocktrans %}</p><br>
</div>
      <div class="d-flex justify-content-center">
    <p><img src="{{ QR_URL }}" alt="QR Code" /></p>
     </div>


  {% elif wizard.steps.current == 'sms' %}
    <p>{% blocktrans trimmed %}Please enter the phone number you wish to receive the
      text messages on. This number will be validated in the next step.
      {% endblocktrans %}</p>
  {% elif wizard.steps.current == 'call' %}
    <p>{% blocktrans trimmed %}Please enter the phone number you wish to be called on.
      This number will be validated in the next step. {% endblocktrans %}</p>
  {% elif wizard.steps.current == 'validation' %}
    {% if challenge_succeeded %}
      {% if device.method == 'call' %}
        <p>{% blocktrans trimmed %}We are calling your phone right now, please enter the
          digits you hear.{% endblocktrans %}</p>
      {% elif device.method == 'sms' %}
        <p>{% blocktrans trimmed %}We sent you a text message, please enter the tokens we
          sent.{% endblocktrans %}</p>
      {% endif %}
    {% else %}
      <p class="alert alert-warning" role="alert">{% blocktrans trimmed %}We've
        encountered an issue with the selected authentication method. Please
        go back and verify that you entered your information correctly, try
        again, or use a different authentication method instead. If the issue
        persists, contact the site administrator.{% endblocktrans %}</p>
    {% endif %}
  {% elif wizard.steps.current == 'yubikey' %}
    <p>{% blocktrans trimmed %}To identify and verify your YubiKey, please insert a
      token in the field below. Your YubiKey will be linked to your
      account.{% endblocktrans %}</p>
  {% endif %}


{% if wizard.steps.current == 'generator' %}
          <form action="" method="post">{% csrf_token %}

    <div align="center">
        <div class="input-group mb-0 ">
                <div class="input-group-append">
                    <span class="input-group-text"><i class="fas fa-key"></i></span>
                </div>
{#                <input type="text" name="username" placeholder="Username" class="form-control">#}
                {{ wizard.form.token }}


            </div>
    </div>
<br>

{#    {% include "two_factor/_wizard_forms.html" %}#}
{{ wizard.management_form }}

    {# hidden submit button to enable [enter] key #}
    <input type="submit" value="" class="d-none" />

    {% include "two_factor/_wizard_actions.html" %}
</form>
                    <script>
            /* Because i didnt set placeholder values in forms.py they will be set here using vanilla Javascript
    //We start indexing at one because CSRF_token is considered and input field
    */

            //Query All input fields
            var form_fields = document.getElementsByTagName('input')
            form_fields[1].placeholder = 'Token';


            for (var field in form_fields) {
                form_fields[field].className += ' form-control'
            }
        </script>



{% else %}

  <form action="" method="post">{% csrf_token %}
    {% include "two_factor/_wizard_forms.html" %}

    {# hidden submit button to enable [enter] key #}
    <input type="submit" value="" class="d-none" />

    {% include "two_factor/_wizard_actions.html" %}
  </form>
 {% endif %}
</div>
{% endblock %}
